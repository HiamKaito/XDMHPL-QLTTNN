USE master
DROP DATABASE TrungTamNgoaiNguDB
CREATE DATABASE TrungTamNgoaiNguDB
USE TrungTamNgoaiNguDB

CREATE TABLE THISINH (
	CMND NVARCHAR(50) NOT NULL,
	HoTen NVARCHAR(50) NOT NULL,
	GioiTinh NVARCHAR(50) NOT NULL,
	NgaySinh datetime NOT NULL,
	NoiSinh NVARCHAR(50) NOT NULL,
	SDT int NOT NULL
)

CREATE TABLE PHONGTHI (
	TenPhongThi NVARCHAR(50) NOT NULL,
	MaKhoaThi NVARCHAR(50) NOT NULL,
	SoLuong int NOT NULL
)

CREATE TABLE PHIEUDUTHI (
	TenPhongThi NVARCHAR(50) NOT NULL,
	CMND NVARCHAR(50) NOT NULL,
	CaThi NVARCHAR(50) NOT NULL,
	SoBaoDanh NVARCHAR(50) NOT NULL
)

CREATE TABLE KHOATHI (
	MaKhoaThi NVARCHAR(50) NOT NULL,
	TenKhoaThi NVARCHAR(50) NOT NULL,
	TrinhDo NVARCHAR(50) NOT NULL,
	NgayThi datetime NOT NULL
)

CREATE TABLE KETQUA (
	CMND NVARCHAR(50) NOT NULL,
	MaKhoaThi NVARCHAR(50) NOT NULL,
	DiemNghe int NOT NULL,
	DiemNoi int NOT NULL,
	DiemDoc int NOT NULL,
	DiemViet int NOT NULL
)

CREATE TABLE DIADIEM (
	MADIADIEM NVARCHAR(50) NOT NULL,
	TENDIADIEM NVARCHAR(50) NOT NULL
)


--KEy -----------------------------------------------------------------
-- PK
ALTER TABLE THISINH
  ADD CONSTRAINT PK_CMND PRIMARY KEY (CMND);

ALTER TABLE PHONGTHI
  ADD CONSTRAINT PK_TenPhongThi PRIMARY KEY (TenPhongThi);

ALTER TABLE KHOATHI
  ADD CONSTRAINT PK_MaKhoaThi PRIMARY KEY (MaKhoaThi);

ALTER TABLE DIADIEM
  ADD CONSTRAINT PK_MADIADIEM PRIMARY KEY (MADIADIEM);

-- FK
ALTER TABLE PHONGTHI
  ADD CONSTRAINT FK_PHONGTHI_MAKHOATHI FOREIGN KEY (MaKhoaThi) REFERENCES KHOATHI (MaKhoaThi);

ALTER TABLE THISINH
  ADD CONSTRAINT FK_THISINH_MADIADIEM FOREIGN KEY (NoiSinh) REFERENCES DIADIEM (MADIADIEM);

ALTER TABLE PHIEUDUTHI
  ADD CONSTRAINT FK_PHIEUDUTHI_TenPhongThi FOREIGN KEY (TenPhongThi) REFERENCES PHONGTHI (TenPhongThi);
ALTER TABLE PHIEUDUTHI
  ADD CONSTRAINT FK_PHIEUDUTHI_CMND FOREIGN KEY (CMND) REFERENCES THISINH (CMND);

ALTER TABLE KETQUA
  ADD CONSTRAINT FK_KQUA_CMND FOREIGN KEY (CMND) REFERENCES THISINH (CMND);
ALTER TABLE KETQUA
  ADD CONSTRAINT FK_KQUA_MaKhoaThi FOREIGN KEY (MaKhoaThi) REFERENCES KHOATHI (MaKhoaThi);

-- Super PK
ALTER TABLE PHIEUDUTHI
  ADD CONSTRAINT PK_MAMH_MAMH_TRUOC PRIMARY KEY (TenPhongThi, CMND);

ALTER TABLE KETQUA
  ADD CONSTRAINT PKMASV_MAKH PRIMARY KEY (CMND, MaKhoaThi);



INSERT INTO DIADIEM VALUES 
('DD1', 'TPHCM'),
('DD2', 'Ha Noi'),
('DD3', 'Ca Mau'),
('DD4', 'Can Tho'),
('DD5', 'Thanh Haa'),
('DD6', 'Đa Nang'),
('DD7', 'Nha Trang'),
('DD8', 'Vung Tau'),
('DD9', 'Lang Son'),
('DD10', 'Thai Binh')

INSERT INTO THISINH VALUES 
('123456789','Tang CHI', 'NAM', '2022-01-04 00:00:00.000', 'DD1', '0123456789'),
('987654321','Tang CHUNG', 'NAM', '2022-01-04 00:00:00.000', 'DD3', '0987654321'),
('121212121','Tang CHI CHUNG', 'NAM', '2022-01-04 00:00:00.000', 'DD5', '0121212121'),
('232323232','Tang CHING', 'NAM', '2022-01-04 00:00:00.000', 'DD7', '0232323232');

INSERT INTO KHOATHI VALUES 
('K18_TT_A2','Tuổi Trẻ', 'A2', '2022-01-04 00:00:00.000'),
('K18_TTN_B1','Tuổi Trung Niên', 'B1', '2022-01-04 00:00:00.000');

INSERT INTO PHONGTHI VALUES
('A2P01', 'K18_TT_A2', '30'),
('B1P01', 'K18_TTN_B1', '30');

INSERT INTO PHIEUDUTHI VALUES
('A2P01','123456789' ,'Ca sáng', 'A2001'),
('A2P01','987654321' ,'Ca sáng', 'A2002'),
('A2P01','121212121' ,'Ca sáng', 'A2003'),
('B1P01','232323232' ,'Ca tối' , 'B1001');

INSERT INTO KETQUA VALUES
('123456789', 'K18_TT_A2', '7', '7', '7', '7'),
('987654321', 'K18_TT_A2', '7', '7', '7', '7' ),
('121212121', 'K18_TT_A2', '7', '7', '7', '7' ),
('232323232', 'K18_TTN_B1', '7', '7', '7', '7');

select * from ketqua
select * from khoathi
select * from phieuduthi
select * from phongthi
select * from thisinh
select * from DIADDIEM
